(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class a{static EVENT_CLICK="click";static EVENT_DOM_CONTENT_LOADED="DOMContentLoaded";static ATTR_ID="id";static ATTR_CLASS="class";static ATTR_DATA="data-";static ELEMENT_APP="app";static CHANNEL_ID="EoIG3R1I4JdyS4L1";static ROOM_NAME="observable-e7b2d4";static StopPropagation(e){e&&(e.stopPropagation(),e.preventDefault())}static StoreUserCredentials(e,t,s,i){return!e||!t||!s||!i?!1:(localStorage.setItem("credentials",btoa(`${e}:${t}:${s}:${i}:${Date.now()}`)),!0)}static VerifyUserCredentials(e,t){if(!e||!t)return!1;const s=localStorage.getItem("credentials");if(!s)return!1;const i=atob(s),[n,r]=i.split(":");return n===e&&r===t}static GetUserDetails(){const e=localStorage.getItem("credentials");if(!e)return null;const t=atob(e),[s,i,n,r,l]=t.split(":");return console.log({password:i}),{username:s,name:n,status:r,id:l}}static IsUserCredentialsStored(){return localStorage.getItem("credentials")!==null}static ClearUserCredentials(){localStorage.removeItem("credentials")}}const h={DRONE_CONNECTED:"Connected to Scaledrone",DRONE_DISCONNECTED:"Disconnected from Scaledrone",DRONE_CONNECTION_FAILED:"Scaledrone connection failed",ROOM_SUBSCRIPTION_FAILED:"Failed to subscribe to room"},u={POKE:"poke"},E={UNKNOWN:"Unknown message"};class d{constructor(e,t){this.m_channelId=e,this.m_roomName=t}async Connect(e,t,s,i){return await new Promise(n=>{this.m_drone=new window.Scaledrone(this.m_channelId,{data:{name:e,status:t,username:s,id:i}}),this.m_drone.on(d.EVENT_OPEN,()=>{console.log(h.DRONE_CONNECTED,this.m_drone?.clientId),this.SubscribeToRoom(),n(!0)}),this.m_drone.on(d.EVENT_ERROR,r=>{console.error(h.DRONE_CONNECTION_FAILED,r),n(!1)}),this.m_drone.on(d.EVENT_CLOSE,()=>{console.log(h.DRONE_DISCONNECTED)})})}Disconnect(){this.m_drone&&this.m_drone.close()}SubscribeToRoom(e=this.m_roomName){if(!this.m_drone)return;const t=this.m_drone.subscribe(e);t.on(d.EVENT_OPEN,s=>{s&&console.error(h.ROOM_SUBSCRIPTION_FAILED,s)}),t.on(d.EVENT_MEMBERS,s=>{this.m_members=s,this.m_membersUpdateCallback(this.m_members)}),t.on(d.EVENT_MEMBER_JOIN,s=>{this.m_members.push(s),this.m_membersUpdateCallback(this.m_members)}),t.on(d.EVENT_MEMBER_LEAVE,s=>{this.m_members=this.m_members.filter(i=>i.id!==s.id),this.m_membersUpdateCallback(this.m_members)}),t.on(d.EVENT_MESSAGE,this.HandleEventMessage.bind(this))}HandleEventMessage(e){const{data:t}=e;if(t){const{type:s}=t;switch(s){case u.POKE:console.log(t);break;default:console.log(E.UNKNOWN+" type",s)}}else console.log(E.UNKNOWN,e)}Publish(e){this.m_drone&&this.m_drone.publish({data:e})}set onMembersUpdate(e){this.m_membersUpdateCallback=e}m_drone={};m_members=[];m_channelId;m_roomName;m_membersUpdateCallback=null;static EVENT_OPEN="open";static EVENT_ERROR="error";static EVENT_CLOSE="close";static EVENT_MESSAGE="message";static EVENT_MEMBERS="members";static EVENT_MEMBER_JOIN="member_join";static EVENT_MEMBER_LEAVE="member_leave"}class o{constructor(e){o.RootElement||(o.RootElement=document.getElementById(a.ELEMENT_APP)),o.dynamicID="div"+this.constructor.name,e&&(this.m_droneService=e),this.Load()}GetElementByID(e){return o.RootElement.querySelector(`#${e}`)}FindByID(e,t){return e?e?.querySelector(`#${t}`):null}FindByClass(e,t){return e.querySelector(`.${t}`)}get m_divContainer(){return this.FindByClass(o.RootElement,o.dynamicID)}static dynamicID="";static RootElement;m_droneService=null}class C extends o{constructor(e){super(e)}Load(){this.m_droneService.onMembersUpdate=this.HandleMembersUpdates.bind(this),this.m_divContainer.classList.remove("Util_hide"),this.m_header=this.GetElementByID("header"),this.m_header.classList.remove("Util_hide")}HandleMembersUpdates(e){this.m_header=this.GetElementByID("header");const t=a.GetUserDetails();if(!t)return;const{id:s,username:i}=t;e.forEach(n=>{if(n.clientData){const{name:r,status:l,id:m,username:_}=n.clientData;console.log({name:r,status:l,id:m,username:_}),m===s&&_===i&&(this.FindByID(this.m_header,"name").textContent=r,this.FindByID(this.m_header,"status").textContent=l)}})}m_header}class N extends o{constructor(){super()}async Load(){a.IsUserCredentialsStored()&&await this.LoginUser()||this.m_divContainer.addEventListener(a.EVENT_CLICK,this.OnClick_divLoginContainer.bind(this))}async OnClick_divLoginContainer(e){switch(a.StopPropagation(e),e.target.id){case"loginTab":this.FindByID(this.m_divContainer,"loginTab").classList.add("active"),this.FindByID(this.m_divContainer,"registerTab").classList.remove("active"),this.FindByID(this.m_divContainer,"login").classList.remove("Util_hide"),this.FindByID(this.m_divContainer,"register").classList.add("Util_hide"),this.FindByID(this.m_divContainer,"name").classList.add("Util_hide"),this.FindByID(this.m_divContainer,"status").classList.add("Util_hide");break;case"registerTab":this.FindByID(this.m_divContainer,"loginTab").classList.remove("active"),this.FindByID(this.m_divContainer,"registerTab").classList.add("active"),this.FindByID(this.m_divContainer,"login").classList.add("Util_hide"),this.FindByID(this.m_divContainer,"register").classList.remove("Util_hide"),this.FindByID(this.m_divContainer,"name").classList.remove("Util_hide"),this.FindByID(this.m_divContainer,"status").classList.remove("Util_hide");break;case"login":const s=this.FindByID(this.m_divContainer,"username").value.toString().trim(),i=this.FindByID(this.m_divContainer,"password").value.toString().trim();a.VerifyUserCredentials(s,i)?await this.LoginUser():alert("Invalid Credentials!");break;case"register":const n=this.FindByID(this.m_divContainer,"username").value.toString().trim(),r=this.FindByID(this.m_divContainer,"password").value.toString().trim(),l=this.FindByID(this.m_divContainer,"name").value.toString().trim(),m=this.FindByID(this.m_divContainer,"status").value.toString().trim();if(a.StoreUserCredentials(n,r,l,m))alert("Registration Successful! You can now login.");else{alert("Registration Failed! Please fill all fields.");return}this.FindByID(this.m_divContainer,"loginTab").classList.add("active"),this.FindByID(this.m_divContainer,"registerTab").classList.remove("active"),this.FindByID(this.m_divContainer,"login").classList.remove("Util_hide"),this.FindByID(this.m_divContainer,"register").classList.add("Util_hide"),this.FindByID(this.m_divContainer,"name").classList.add("Util_hide"),this.FindByID(this.m_divContainer,"status").classList.add("Util_hide");break}}async LoginUser(){const e=a.GetUserDetails();if(!e)return alert("User details not found!"),!1;const t=this.m_divContainer,{username:s,name:i,status:n,id:r}=e;return this.m_droneService=new d(a.CHANNEL_ID,a.ROOM_NAME),await this.m_droneService.Connect(i,n,s,r)?(t.classList.add("Util_hide"),new C(this.m_droneService),!0):!1}}class I extends o{constructor(){super()}Load(){new N}}class g extends o{constructor(){super()}Load(){new I}}console.trace("App initializing...");document.addEventListener(a.EVENT_DOM_CONTENT_LOADED,()=>{new g});

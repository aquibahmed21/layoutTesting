(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&t(m)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const E={DRONE_CONNECTED:"Connected to Scaledrone",DRONE_DISCONNECTED:"Disconnected from Scaledrone",DRONE_CONNECTION_FAILED:"Scaledrone connection failed",ROOM_SUBSCRIPTION_FAILED:"Failed to subscribe to room"},d={POKE:"poke"},a={UNKNOWN:"Unknown message"};class r{constructor(e,n,t){this.m_channelId=e,this.m_roomName=n,this.onMembersUpdate=t}Connect(){this.m_drone=new window.Scaledrone(this.m_channelId,{data:{name:`User-${Math.floor(Math.random()*1e3)}`}}),this.m_drone.on(r.EVENT_OPEN,()=>{console.log(E.DRONE_CONNECTED,this.m_drone?.clientId),this.SubscribeToRoom()}),this.m_drone.on(r.EVENT_ERROR,e=>{console.error(E.DRONE_CONNECTION_FAILED,e)}),this.m_drone.on(r.EVENT_CLOSE,()=>{console.log(E.DRONE_DISCONNECTED)})}Disconnect(){this.m_drone&&this.m_drone.close()}SubscribeToRoom(e=this.m_roomName){if(!this.m_drone)return;const n=this.m_drone.subscribe(e);n.on(r.EVENT_OPEN,t=>{t&&console.error(E.ROOM_SUBSCRIPTION_FAILED,t)}),n.on(r.EVENT_MEMBERS,t=>{this.m_members=t,this.onMembersUpdate(this.m_members)}),n.on(r.EVENT_MEMBER_JOIN,t=>{this.m_members.push(t),this.onMembersUpdate(this.m_members)}),n.on(r.EVENT_MEMBER_LEAVE,t=>{this.m_members=this.m_members.filter(o=>o.id!==t.id),this.onMembersUpdate(this.m_members)}),n.on(r.EVENT_MESSAGE,this.HandleEventMessage.bind(this))}HandleEventMessage(e){const{data:n}=e;if(n){const{type:t}=n;switch(t){case d.POKE:console.log(n);break;default:console.log(a.UNKNOWN+" type",t)}}else console.log(a.UNKNOWN,e)}Publish(e){this.m_drone&&this.m_drone.publish({data:e})}m_drone={};m_members=[];m_channelId;m_roomName;onMembersUpdate;static EVENT_OPEN="open";static EVENT_ERROR="error";static EVENT_CLOSE="close";static EVENT_MESSAGE="message";static EVENT_MEMBERS="members";static EVENT_MEMBER_JOIN="member_join";static EVENT_MEMBER_LEAVE="member_leave"}class _{constructor(){this.m_contactsEl=document.getElementById("contacts")}UpdateContacts(e){this.m_contactsEl.innerHTML="",e.forEach(n=>{const t=document.createElement("div");t.className="contact",t.textContent=n.clientData?.name||n.id,this.m_contactsEl.appendChild(t)})}m_contactsEl}class N{GetElementByID(e){return document.getElementById(e)}FindByID(e,n){return e?e.querySelector(`#${n}`):null}CreateElement(e,n,t){const o=document.createElement(e);return n&&(o.className=n),t&&(o.textContent=t),o}On(e,n,t){e&&e.addEventListener(n,t)}}const c={EVENT_CLICK:"click",EVENT_DOM_CONTENT_LOADED:"DOMContentLoaded",ELEMENT_APP:"app",CHANNEL_ID:"EoIG3R1I4JdyS4L1",ROOM_NAME:"observable-e7b2d4"};class i extends N{constructor(){super(),this.UI=new _,this.m_RootElement=this.GetElementByID(c.ELEMENT_APP),this.SetupEvents()}SetupEvents(){const e=this.FindByID(this.m_RootElement,i.s_connectBtn);e&&e.addEventListener(c.EVENT_CLICK,()=>this.Connect())}Connect(){const e=this.FindByID(this.m_RootElement,i.s_channel).value||c.CHANNEL_ID,n=this.FindByID(this.m_RootElement,i.s_room).value||c.ROOM_NAME;this.m_droneService=new r(e,n,t=>this.UI.UpdateContacts(t)),this.m_droneService.Connect()}UI;m_RootElement=null;m_droneService=null;static s_connectBtn="connectBtn";static s_channel="channel";static s_room="room"}document.addEventListener(c.EVENT_DOM_CONTENT_LOADED,()=>new i);

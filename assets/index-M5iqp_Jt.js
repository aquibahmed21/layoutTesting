(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();class l{constructor(e,t,o){this.m_channelId=e,this.m_roomName=t,this.onMembersUpdate=o}Connect(){this.m_drone=new window.Scaledrone(this.m_channelId,{data:{name:`User-${Math.floor(Math.random()*1e3)}`}}),this.m_drone.on("open",e=>{if(e){console.error("Scaledrone connection failed:",e);return}console.log("Connected to Scaledrone as:",this.m_drone?.clientId),this.SubscribeToRoom()})}SubscribeToRoom(){if(!this.m_drone)return;const e=this.m_drone.subscribe(this.m_roomName);e.on("open",t=>{t&&console.error("Room subscription error:",t)}),e.on("members",t=>{this.m_members=t,this.onMembersUpdate(this.m_members)}),e.on("member_join",t=>{this.m_members.push(t),this.onMembersUpdate(this.m_members)}),e.on("member_leave",t=>{this.m_members=this.m_members.filter(o=>o.id!==t.id),this.onMembersUpdate(this.m_members)})}m_drone=null;m_members=[];m_channelId;m_roomName;onMembersUpdate}class d{constructor(){this.m_contactsEl=document.getElementById("contacts")}UpdateContacts(e){this.m_contactsEl.innerHTML="",e.forEach(t=>{const o=document.createElement("div");o.className="contact",o.textContent=t.clientData?.name||t.id,this.m_contactsEl.appendChild(o)})}m_contactsEl}class a{GetElementByID(e){return document.getElementById(e)}FindByID(e,t){return e?e.querySelector(`#${t}`):null}CreateElement(e,t,o){const n=document.createElement(e);return t&&(n.className=t),o&&(n.textContent=o),n}On(e,t,o){e&&e.addEventListener(t,o)}}const i={EVENT_CLICK:"click",ELEMENT_APP:"app",CHANNEL_ID:"EoIG3R1I4JdyS4L1",ROOM_NAME:"observable-e7b2d4"};class r extends a{constructor(){super(),this.UI=new d,this.m_RootElement=this.GetElementByID(i.ELEMENT_APP),this.SetupEvents()}SetupEvents(){const e=this.FindByID(this.m_RootElement,r.s_connectBtn);e&&e.addEventListener(i.EVENT_CLICK,()=>this.Connect())}Connect(){const e=this.FindByID(this.m_RootElement,r.s_channel).value||i.CHANNEL_ID,t=this.FindByID(this.m_RootElement,r.s_room).value||i.ROOM_NAME;this.m_droneService=new l(e,t,o=>this.UI.UpdateContacts(o)),this.m_droneService.Connect()}UI;m_RootElement=null;m_droneService=null;static s_connectBtn="connectBtn";static s_channel="channel";static s_room="room"}document.addEventListener("DOMContentLoaded",()=>{new r});
